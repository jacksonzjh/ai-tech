<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


code {
  font-family: Menlo, Monaco, Consolas, Courier New, monospace;
  word-break: break-word;
  border-radius: .125rem;
  overflow-x: auto;
  background-color: #fff5f5;
  color: #ff502c;
  font-size: 0.87em;
  padding: 0.065em 0.4em;
}

a {
  text-decoration: none;
  color: #0269c8;
  border-bottom: 1px solid #d1e9ff;
}

code::before {
  content: none;
}

code::after {
  content: none;
}

#write {
  font-size: 16px;
  line-height: 26px;
  max-width: 928px;
}

@media only screen and (min-width: 87.5rem) {
  #write {
    max-width: 1024px;
  }
}

@media only screen and (min-width: 112.5rem) {
  #write {
    max-width: 1200px;
  }
}
p {
  line-height: inherit;
    margin-top: 22px;
    margin-bottom: 22px;
}
h1 {
  font-size: 2.5rem;
  line-height: 2.75rem;
  margin-bottom: 1.5rem;
  letter-spacing: -0.0938rem;
}

h2 {
  font-size: 1.375rem;
  line-height: 2.125rem;
  padding-bottom: .75rem;
  border-bottom: .0625rem solid #ececec;
  font-weight: bold;
}

h3 {
  font-size: 1.25rem;
  line-height: 1.75rem;
  margin-top: 2.1875rem;
  margin-bottom: .625rem;
  padding-bottom: .3125rem;
}

h4 {
  font-size: 1.125rem;
  line-height: 1.625rem;
  margin-top: 2.1875rem;
  margin-bottom: .625rem;
  padding-bottom: .3125rem;
  font-weight: bold;
}

h5 {
  font-size: 15.52px;
  line-height: 20px;
  margin-bottom: 24px;
  font-weight: bold;
}

h6 {
  font-size: 14.88px;
  line-height: 16px;
  margin-bottom: 12px;
}

pre,
code,
kbd,
tt,
var {
  font-size: 0.875em;
}

blockquote {
  color: #666;
  padding: 10px 23px;
  margin: 22px 0;
  border-left: 4px solid #cbcbcb;
  background-color: #f8f8f8;
  font-style: normal;
}

blockquote p {
  margin: 10px 0;
}

img {
  border-radius: 1.25rem;
  float: left;
}

ul {
  padding: 0;
  margin: 0;
  padding-left: 1.75rem;
}
ul > li::marker {
  color: black;
  margin-bottom: 0;
}
ol > li::marker {
  color: black;
  margin-bottom: 0;
}
@import "";

/* FONTS */

/* @font-face {
  font-family: "LXGWWenKai-Blod";
  font-display: block;
  src: url("file:///C://Users//%E5%91%A8%E5%AE%8F%E5%93%B2//AppData//Roaming//Typora/themes/ladder/LXGWWenKai-Bold.woff2") format("truetype");
  font-named-instance: "Blod";
} */

/* VARIABLES */

:root {
  --theme-0: #fff;

  /* Slate grayscale */
  --theme-50: #f8fafc;
  --theme-100: #f1f5f9;
  --theme-200: #e2e8f0;
  --theme-300: #cbd5e1;
  --theme-400: #94a3b8;
  --theme-500: #64748b;
  --theme-600: #475569;
  --theme-700: #334155;
  --theme-800: #1e293b;
  --theme-900: #0f172a;

  /* Tailwind variables */
  --tw-primary: #62bbf3;

  --tw-prose-body: var(--theme-700);
  --tw-prose-headings: var(--theme-900);
  --tw-prose-lead: var(--theme-600);
  --tw-prose-links: var(--theme-900);
  --tw-prose-bold: var(--theme-900);
  --tw-prose-counters: var(--theme-500);
  --tw-prose-bullets: var(--theme-300);
  --tw-prose-hr: var(--theme-200);
  --tw-prose-quotes: var(--theme-900);
  --tw-prose-quote-borders: var(--theme-200);
  --tw-prose-captions: var(--theme-500);
  --tw-prose-code: var(--theme-900);
  --tw-prose-pre-code: var(--theme-100);
  --tw-prose-pre-bg: var(--theme-800);
  --tw-prose-th-borders: var(--theme-300);
  --tw-prose-td-borders: var(--theme-200);
  --tw-prose-bg: var(--theme-0);
  --tw-prose-meta: var(--theme-500);
  --tw-prose-meta-bg: var(--theme-100);

  --tw-prose-invert-body: var(--theme-300);
  --tw-prose-invert-headings: var(--theme-0);
  --tw-prose-invert-lead: var(--theme-400);
  --tw-prose-invert-links: var(--theme-0);
  --tw-prose-invert-bold: var(--theme-0);
  --tw-prose-invert-counters: var(--theme-400);
  --tw-prose-invert-bullets: var(--theme-600);
  --tw-prose-invert-hr: var(--theme-700);
  --tw-prose-invert-quotes: var(--theme-100);
  --tw-prose-invert-quote-borders: var(--theme-700);
  --tw-prose-invert-captions: var(--theme-400);
  --tw-prose-invert-code: var(--theme-0);
  --tw-prose-invert-pre-bg: var(--theme-900);
  --tw-prose-invert-th-borders: var(--theme-600);
  --tw-prose-invert-td-borders: var(--theme-700);
  --tw-prose-invert-bg: var(--theme-800);
  --tw-prose-invert-meta: var(--theme-400);
  --tw-prose-invert-meta-bg: var(--theme-700);

  --tw-highlight-color: #fde047; /* yellow-300 */
  --tw-drop-shadow-md: drop-shadow(0 4px 3px rgb(0 0 0 / 0.07))
    drop-shadow(0 2px 2px rgb(0 0 0 / 0.06));
  --tw-button-hover-bg: var(--theme-100);

  --tw-button-hover-bg-inverted: var(--theme-700);

  /* Typora variables */

  --background: var(--tw-prose-bg);
  --bg-color: var(--tw-prose-bg);
  --text-color: var(--tw-prose-body);
  --primary-color: var(--tw-primary);
  --md-char-color: var(--theme-400);
  --meta-content-color: var(--theme-500);
  --typora-source-body: var(--theme-800);
  --heading-char-color: var(--md-char-color);
  --mermaid-theme: neutral;
  --active-toggle-btn-color: var(--theme-200);

  --md-char-color-inverted: var(--theme-500);
  --meta-content-color-inverted: var(--theme-400);
  --typora-source-body-inverted: var(--theme-300);
  --mermaid-theme-inverted: dark;
  --active-toggle-btn-color-inverted: var(--theme-400);

  /* Sidebar */
  --side-bar-bg-color: var(--tw-prose-bg);
  --active-file-bg-color: var(--theme-100);
  --active-file-text-color: var(--tw-prose-bold);
  --active-file-border-color: var(--theme-100);
  --panel-border-color: var(--theme-300);
  --blur-text-color: var(--theme-300);
  --window-border: 1px solid var(--theme-200);
  --item-hover-bg-color: var(--theme-100);
  --search-hit-text-bg-color: var(--theme-200);
  --search-hit-text-font-color: inherit;
  --search-select-text-color: var(--select-text-font-color);
  --search-select-bg-color: var(--select-text-bg-color);

  --blur-text-color-inverted: var(--theme-500);
  --panel-border-color-inverted: var(--theme-700);
  --active-file-bg-color-inverted: var(--theme-700);
  --window-border-inverted: 1px solid var(--theme-700);
  --search-hit-text-bg-color-inverted: var(--theme-700);
  --search-hit-text-font-color-inverted: var(--theme-0);
  --search-select-bg-color-inverted: var(--theme-400);
  --rawblock-edit-panel-bd: var(--tw-prose-pre-bg);
  --item-hover-bg-color-inverted: var(--theme-700);

  --monospace: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
    "Liberation Mono", "Courier New", monospace;

  /* Custom */
  --footnote: var(--tw-prose-body);
  /* I'd love to use the --theme grayscale for --footnote-bg, but there's (currently)
  no way to add an alpha-channel to a CSS variable (and we need the transparency
  because otherwise the caret wil not be visible), so I here just used a hardcoded
  copy of --theme-500 */
  --footnote-bg: #94a3b855;
  --button-bg: var(--theme-200);

  --button-bg-inverted: var(--theme-600);

  --md-grid-header: var(--theme-100);
  --md-grid-header-ext: var(--theme-400);
  --md-grid-ext: var(--theme-300);
  --md-grid-header-active: var(--theme-500);
  --md-grid-active: var(--theme-400);
  --md-grid-border-color: var(--theme-500);

  --md-grid-header-inverted: var(--theme-600);
  --md-grid-header-ext-inverted: var(--theme-500);
  --md-grid-ext-inverted: var(--theme-600);
  --md-grid-header-active-inverted: var(--theme-400);
  --md-grid-active-inverted: var(--theme-500);
  --md-grid-border-color-inverted: var(--theme-200);

  --code-blocks-font-size: 0.9em;
  --inline-code-font-size: 0.9em;
}

.ty-file-search-match-text {
  background-color: var(--search-hit-text-bg-color);
}

/* TAILWIND RESET */

/*
1. Prevent padding and border from affecting element width. (https://github.com/mozdevs/cssremedy/issues/4)
2. Allow adding a border to an element by just adding a border-width. (https://github.com/tailwindcss/tailwindcss/pull/116)
*/

*,
::before,
::after {
  box-sizing: border-box;
  /* 1 */
  border-width: 0;
  /* 2 */
  border-style: solid;
  /* 2 */
  border-color: currentColor;
  /* 2 */
}

::before,
::after {
  --tw-content: "";
}

/*
1. Use a consistent sensible line-height in all browsers.
2. Prevent adjustments of font size after orientation changes in iOS.
3. Use a more readable tab size.
*/

#text {
  line-height: 1.5;
  /* 1 */
  -webkit-text-size-adjust: 100%;
  /* 2 */
  -moz-tab-size: 4;
  /* 3 */
  -o-tab-size: 4;
  tab-size: 4;
  /* 3 */
}

/*
1. Remove the margin in all browsers.
2. Inherit line-height from `html` so users can set them as a class directly on the `html` element.
*/

#text {
  margin: 0;
  /* 1 */
  line-height: inherit;
  /* 2 */
}

/*
1. Add the correct height in Firefox.
2. Correct the inheritance of border color in Firefox. (https://bugzilla.mozilla.org/show_bug.cgi?id=190655)
3. Ensure horizontal rules are visible by default.
*/

hr {
  height: 0;
  /* 1 */
  color: inherit;
  /* 2 */
  border-top-width: 1px;
  /* 3 */
}

/*
Add the correct text decoration in Chrome, Edge, and Safari.
*/

abbr:where([title]) {
  -webkit-text-decoration: underline dotted;
  text-decoration: underline dotted;
}

/*
Remove the default font size and weight for headings.
*/

h1,
h2,
h3,
h4,
h5,
h6 {
  font-size: inherit;
  font-weight: inherit;
  /* font-family: "LXGWWenKai-Blod"; */
  font-family: "PingFang SC";
}

/*
Reset links to optimize for opt-in styling instead of opt-out.
*/

a {
  color: inherit;
  text-decoration: inherit;
}

/*
Add the correct font weight in Edge and Safari.
*/

b,
strong {
  font-weight: bolder;
}

/*
1. Use the user's configured `mono` font family by default.
2. Correct the odd `em` font sizing in all browsers.
*/

code,
kbd,
samp,
pre {
  font-family: var(--monospace);
  /* 1 */
  font-size: 1em;
  /* 2 */
}

/*
Add the correct font size in all browsers.
*/

small {
  font-size: 80%;
}

/*
Prevent `sub` and `sup` elements from affecting the line height in all browsers.
*/

sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sub {
  bottom: -0.25em;
}

sup {
  top: -0.5em;
}

/*
1. Remove text indentation from table contents in Chrome and Safari. (https://bugs.chromium.org/p/chromium/issues/detail?id=999088, https://bugs.webkit.org/show_bug.cgi?id=201297)
2. Correct table border color inheritance in all Chrome and Safari. (https://bugs.chromium.org/p/chromium/issues/detail?id=935729, https://bugs.webkit.org/show_bug.cgi?id=195016)
3. Remove gaps between table borders by default.
*/

table {
  text-indent: 0;
  /* 1 */
  border-color: inherit;
  /* 2 */
  border-collapse: collapse;
  /* 3 */
}

/*
1. Change the font styles in all browsers.
2. Remove the margin in Firefox and Safari.
3. Remove default padding in all browsers.
*/

button,
input,
optgroup,
select,
textarea {
  font-family: inherit;
  /* 1 */
  font-size: 100%;
  /* 1 */
  line-height: inherit;
  /* 1 */
  color: inherit;
  /* 1 */
  margin: 0;
  /* 2 */
  padding: 0;
  /* 3 */
}

/*
Removes the default spacing and border for appropriate elements.
*/

blockquote,
dl,
dd,
h1,
h2,
h3,
h4,
h5,
h6,
hr,
figure,
p,
pre {
  margin: 0;
}

fieldset {
  margin: 0;
  padding: 0;
}

legend {
  padding: 0;
}

ol,
ul,
menu {
  list-style: none;
  margin: 0;
  padding: 0;
}

/*
Prevent resizing textareas horizontally by default.
*/

textarea {
  resize: vertical;
}

/* TAILWIND PROSE IMPLEMENTATION */

#write {
  font-size: 1.25rem /* 20px */;
  line-height: 1.8;
}

html,
body {
  font-family: "PingFang SC";
}

/* on Windows/Linux, it is the part that is not titlebar or status bar. */
content,
titlebar {
  background: var(--tw-prose-bg);
}

#write {
  padding-top: 30px;
  padding-bottom: 30px;
  color: var(--tw-prose-body);
  max-width: 60ch;
}

#write > :where(:first-child) {
  margin-top: 0;
}

#write > :where(:last-child) {
  margin-bottom: 0;
}

/**
  * ---------------------
  * Block Elements
  */

/* yaml */
pre.md-meta-block {
  color: var(--tw-prose-meta);
  background-color: var(--tw-prose-meta-bg);
  font-weight: 400;
  font-size: var(--code-blocks-font-size);
  line-height: 1.7777778;
  border-radius: 0.5rem /* 8px */;
  padding: 1.1111111em 1.3333333em;
  margin-bottom: 2.8em;
}

/* headings */
h1 {
  color: var(--tw-prose-headings);
  font-weight: 800;
  font-size: 2.8em;
  margin-top: 0;
  margin-bottom: 0.8571429em;
  line-height: 1;
}

h1 strong {
  font-weight: 900;
}

h2 {
  color: var(--tw-prose-headings);
  font-weight: 700;
  font-size: 1.8em;
  margin-top: 1.5555556em;
  margin-bottom: 0.8888889em;
  line-height: 1.1111111;
}

h2 strong {
  font-weight: 800;
}

h3 {
  color: var(--tw-prose-headings);
  font-weight: 600;
  font-size: 1.5em;
  margin-top: 1.6em;
  margin-bottom: 0.6666667em;
  line-height: 1.3333333;
}

h3 strong {
  font-weight: 700;
}

h4 {
  color: var(--tw-prose-headings);
  font-weight: 600;
  margin-top: 1.8em;
  margin-bottom: 0.6em;
  line-height: 1.6;
}

h4 strong {
  font-weight: 700;
}

h2 code {
  font-size: 0.8611111em;
}

h3 code {
  font-size: 0.9em;
}

h2 + * {
  margin-top: 0;
}

h3 + * {
  margin-top: 0;
}

h4 + * {
  margin-top: 0;
}

/* table */

table {
  width: 100%;
  table-layout: auto;
  text-align: left;
  margin-top: 2em;
  margin-bottom: 2em;
  font-size: 0.9em;
  line-height: 1.5555556;
}

/* table header */

thead {
  border-bottom-width: 1px;
  border-bottom-color: var(--tw-prose-th-borders);
}

thead th {
  color: var(--tw-prose-headings);
  font-weight: 600;
  vertical-align: bottom;
  padding-right: 0.6666667em;
  padding-bottom: 0.8888889em;
  padding-left: 0.6666667em;
}

thead th:first-child {
  padding-left: 0;
}

thead th:last-child {
  padding-right: 0;
}

tbody tr {
  border-bottom-width: 1px;
  border-bottom-color: var(--tw-prose-td-borders);
}

tbody tr:last-child {
  border-bottom-width: 0;
}

tbody td {
  vertical-align: baseline;
  padding-top: 0.8888889em;
  padding-right: 0.6666667em;
  padding-bottom: 0.8888889em;
  padding-left: 0.6666667em;
}

tbody td:first-child {
  padding-left: 0;
}

tbody td:last-child {
  padding-right: 0;
}

.md-grid-board tr[row="1"] {
  background-color: var(--md-grid-header);
}

.md-grid-board a:hover,
.md-grid-board a.md-active {
  background: var(--md-grid-active);
}

.md-grid-board tr[row="1"] a:hover,
.md-grid-board tr[row="1"] a.md-active {
  background: var(--md-grid-header-active);
}

.md-grid-board .md-grid-ext {
  background: var(--md-grid-ext);
}

.md-grid-board tr[row="1"] .md-grid-ext {
  background: var(--md-grid-header-ext);
}

.md-grid-board a {
  border-color: var(--md-grid-border-color) !important;
}

/* lists */

ol {
  list-style-type: decimal;
  padding-left: 1.6em;
}

li {
  margin-top: 0.6em;
  margin-bottom: 0.6em;
}

ul {
  list-style-type: disc;
  padding-left: 1.6em;
}

#write ul.task-list {
  padding-left: 0;
}

#write li.task-list-item {
  padding-left: 0.4em;
}

#write input[type="checkbox"] {
  margin-left: -1em;
}

input[checked] ~ * {
  opacity: 0.7;
  text-decoration: line-through;
}

ol > li::marker {
  font-weight: 400;
  color: var(--tw-prose-counters);
}

ul > li::marker {
  color: var(--tw-prose-bullets);
}

ul > li,
ol > li {
  padding-left: 0.4em;
}

ul > li p,
ol > li p {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}

#write > ul > li > :not(input):first-child,
#write > ol > li > :not(input):first-child,
#write > ul > li > input + *,
#write > ol > li > input + * {
  margin-top: 1.2em;
}

#write > ul > li > *:last-child,
#write > ol > li > *:last-child {
  margin-bottom: 1.2em;
}

#write ul > li > p:only-child,
#write ol > li > p:only-child,
#write ul > li > input + p:last-child,
#write ol > li > input + p:last-child {
  margin-top: 0;
  margin-bottom: 0;
}

ul ul,
ul ol,
ol ul,
ol ol {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}

/* blockquote */
blockquote {
  font-weight: 500;
  font-style: italic;
  color: var(--tw-prose-quotes);
  border-left-width: 0.25rem;
  border-left-color: var(--tw-prose-quote-borders);
  quotes: "\201C""\201D""\2018""\2019";
  margin-top: 1.6em;
  margin-bottom: 1.6em;
  padding-left: 1.0666667em;
}

blockquote p:first-of-type::before {
  /* content: open-quote; */
}

blockquote p:last-of-type::after {
  /* content: close-quote; */
}

/* hr */
hr {
  border-color: var(--tw-prose-hr);
  border-top-width: 1px;
}

[mdtype="hr"] {
  margin-top: 2.8em;
  margin-bottom: 2.8em;
}

p {
  margin-top: 1.2em;
  margin-bottom: 1.2em;
}

/* diagram panel */
.md-diagram-panel {
  color: var(--tw-prose-body);
}

.enable-diagrams .md-diagram .code-tooltip {
  bottom: -1.9em;
  right: 0;
}

.md-fences-adv-panel {
  margin-top: 1.3em;
}

/* footnote definition */
sup.md-footnote {
  color: var(--footnote);
  background-color: var(--footnote-bg);
}

.footnotes {
  font-size: 0.85em;
}

.md-reverse-footnote-area a {
  font-family: "PingFang SC";
  text-decoration: none;
  color: var(--tw-primary);
  border-radius: 3px;
}

.md-hover-tip .code-tooltip-content {
  font-size: 1.05rem;
  line-height: 1.6;
  padding: 0.8em 1.2em;
}

.md-reverse-footnote-area a:hover {
  background-color: var(--item-hover-bg-color);
}

.md-def-name:before {
  color: var(--md-char-color);
}

.md-rawblock.md-rawblock-on-edit,
.md-rawblock:hover {
  color: var(--tw-prose-pre-code);
}

.md-inline-math script {
  color: var(--tw-prose-code);
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: var(--tw-highlight-color) !important;
}

g[data-mml-node="merror"] > g {
  fill: #000 !important;
  stroke: #000 !important;
}

.code-tooltip {
  color: var(--tw-prose-pre-code);
}

.code-tooltip .md-mathjax-preview {
  color: var(--tw-prose-body);
}

.md-htmlblock-container,
.md-rawblock-input.md-rawblock-control,
.md-htmlblock-panel.md-rawblock-control,
.md-math-container {
  border-radius: 0.5rem 0 0.5rem 0.5rem;
}

.md-rawblock-input {
  font-size: var(--code-blocks-font-size);
  padding: 0 1.3333333em;
}

.md-mathblock-panel .md-rawblock-input.md-rawblock-control {
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-radius: 0;
}

.md-mathblock-panel .md-rawblock-before {
  padding-top: 1.1em;
  border-top-left-radius: 0.5rem;
}

.md-mathblock-panel .md-rawblock-after {
  padding-bottom: 1.1em;
  border-bottom-left-radius: 0.5rem;
  border-bottom-right-radius: 0.5rem;
}

.md-htmlblock-panel .md-rawblock-input {
  padding-top: 1.1111111em;
  padding-bottom: 1.1111111em;
}

.md-mathblock-panel .md-rawblock-before,
.md-mathblock-panel .md-rawblock-after {
  font-size: var(--code-blocks-font-size);
  padding-left: calc(4px + 1.3333333em);
  color: var(--code-bracket);
}

.md-rawblock-tooltip {
  color: var(--tw-prose-pre-code);
  border-radius: 0.5rem 0.5rem 0 0;
}

.md-rawblock-tooltip-name {
  opacity: 1;
}

.md-comment {
  font-size: var(--inline-code-font-size);
  color: var(--code-comment);
}

.md-raw-inline,
.md-tag,
[md-inline="linebreak"],
.md-image > .md-meta,
.md-inline-math.md-expand > .md-inline-math-container {
  font-size: var(--code-blocks-font-size);
}

/**
  * Code Fences
  * see http://support.typora.io/Code-Block-Styles
  */

.md-fences {
  color: var(--tw-prose-pre-code);
  background-color: var(--tw-prose-pre-bg);
  font-weight: 400;
  font-size: var(--code-blocks-font-size);
  line-height: 1.7777778;
  margin-top: 2em;
  margin-bottom: 2em;
  border-radius: 0.5rem /* 8px */;
  padding: 1.1111111em 1.3333333em;
}

.md-fences.md-focus {
  border-bottom-right-radius: 0;
}

.md-fences > .code-tooltip {
  height: 1.8rem;
  bottom: -1.8rem;
  font-size: 0.9rem;
  border-radius: 0 0 0.5rem 0.5rem;
}

.code-tooltip .ty-input {
  min-width: 10rem;
}

pre code {
  background-color: transparent;
  border-width: 0;
  border-radius: 0;
  padding: 0;
  font-weight: inherit;
  color: inherit;
  font-size: inherit;
  font-family: inherit;
  line-height: inherit;
}

pre code::before {
  content: none;
}

pre code::after {
  content: none;
}

/* SYNTAX HIGHLIGHTING */

:root {
  --code-neutral: var(--theme-800);
  --code-cursor: var(--theme-900);
  --code-string: rgb(14, 165, 233); /* sky-500 */
  --code-number: rgb(245, 158, 11); /* amber-500 */
  --code-tag: rgb(236, 72, 153); /* pink-500 */
  --code-variable: var(--theme-700);
  --code-operator: var(--theme-600);
  --code-comment: var(--theme-500);
  --code-bracket: var(--theme-500);
  --code-citation: var(--theme-500);

  --code-neutral-inverted: var(--theme-100);
  --code-cursor-inverted: var(--theme-50);
  --code-string-inverted: #7dd4fc; /* sky-300 */
  --code-number-inverted: #fde68a; /* amber-100 */
  --code-tag-inverted: #f472b5; /* pink-400 */
  --code-variable-inverted: var(--theme-200);
  --code-operator-inverted: var(--theme-400);
  --code-comment-inverted: var(--theme-400);
  --code-bracket-inverted: var(--theme-500);
  --code-citation-inverted: var(--theme-400);
}

#write .cm-s-inner {
  --code-neutral: var(--code-neutral-inverted);
  --code-cursor: var(--code-cursor-inverted);
  --code-string: var(--code-string-inverted);
  --code-number: var(--code-number-inverted);
  --code-tag: var(--code-tag-inverted);
  --code-variable: var(--code-variable-inverted);
  --code-operator: var(--code-operator-inverted);
  --code-comment: var(--code-comment-inverted);
  --code-bracket: var(--code-bracket-inverted);
  --code-citation: var(--code-citation-inverted);
}

.CodeMirror-selectedtext {
  background-color: transparent;
}
.CodeMirror-cursor {
  border-left: 1px solid var(--code-cursor) !important;
}
.CodeMirror-gutters {
  border-color: var(--code-comment);
}
.cm-s-inner span.cm-string {
  color: var(--code-string);
}

.cm-s-inner span.cm-number {
  color: var(--code-number);
}

.cm-s-inner span.cm-tag,
.cm-s-inner span.cm-keyword,
.cm-s-inner span.cm-qualifier {
  color: var(--code-tag);
}

.cm-s-inner .CodeMirror-guttermarker,
.cm-s-inner .CodeMirror-guttermarker-subtle,
.cm-s-inner span.cm-comment.cm-def,
.cm-s-inner span.cm-comment.cm-type,
.cm-s-inner span.cm-builtin,
.cm-s-inner span.cm-type,
.cm-s-inner span.cm-header,
.cm-s-inner span.cm-link,
.cm-s-inner span.cm-error {
  background: transparent;
  color: var(--code-neutral);
}

.cm-s-inner span.cm-attribute,
.cm-s-inner span.cm-property,
.cm-s-inner span.cm-variable,
.cm-s-inner span.cm-variable-2,
.cm-s-inner span.cm-variable-3,
.cm-s-inner span.cm-type,
.cm-s-inner span.cm-atom,
.cm-s-inner span.cm-def {
  color: var(--code-variable);
}
.cm-s-inner span.cm-comment,
.cm-s-inner .CodeMirror-linenumber {
  color: var(--code-comment);
}
.cm-s-inner span.cm-operator {
  color: var(--code-operator);
}
.cm-s-inner span.cm-bracket,
.cm-s-inner span.cm-tag.cm-bracket,
.cm-s-inner span.cm-meta {
  color: var(--code-bracket);
}

.cm-s-inner span.cm-link {
  text-decoration: underline;
}

/**
  * Inline Elements
  */

/* basic styles */

code {
  color: var(--tw-prose-code);
  font-weight: 600;
  font-size: var(--inline-code-font-size);
}

code::before {
  content: "`";
}

code::after {
  content: "`";
}

[md-inline="code"].md-expand > code::before,
[md-inline="code"].md-expand > code::after {
  content: "";
}

a code {
  color: var(--tw-prose-links);
}

mark code {
  color: inherit;
}

strong {
  color: var(--tw-prose-bold);
  font-weight: 600;
}

a {
  color: var(--tw-prose-links);
  text-decoration: underline;
  font-weight: 500;
}

/* A block-level image should have a total top and bottom margin of 2em.
It is always wrapped in a paragraph with 1.2em vertical margin, hence we
add 0.8 here */
p > .md-image:only-child {
  margin-top: 0.8em !important;
  margin-bottom: 0.8em !important;
}

.md-image > .md-meta {
  color: var(--tw-prose-code);
}

/* extend styles */

mark {
  border-radius: 3px;
  padding: 0 2px;
  background-color: var(--tw-highlight-color);
}

/**
  * Source Code Mode
  * see http://support.typora.io/Code-Block-Styles
  */

.cm-s-typora-default .CodeMirror-activeline-background {
  background-color: var(--item-hover-bg-color);
}

#typora-source {
  font-family: var(--monospace);
  color: var(--typora-source-body);
}

#typora-source .cm-header {
  color: var(--code-tag);
}

#typora-source .cm-link {
  color: var(--code-string);
}

#typora-source .cm-string {
  color: var(--code-string);
}

#typora-source .cm-comment {
  color: var(--code-comment);
}

#typora-source .cm-atom {
  color: var(--code-citation);
}

#typora-source .cm-tag {
  color: var(--code-tag);
}

#typora-source .cm-attribute {
  color: var(--code-variable);
}

#typora-source .cm-bracket {
  color: var(--code-bracket);
}

.file-list-item-file-ext-part {
  opacity: 0.5;
}

#write div.md-toc-tooltip {
  background-color: var(--tw-prose-bg);
}

.md-toc {
  font-size: 0.8em;
}

.md-toc-h1 .md-toc-inner {
  margin-left: 0;
}

.md-toc-h2 .md-toc-inner {
  margin-left: 1em;
}

.md-toc-h3 .md-toc-inner {
  margin-left: 2em;
}

.md-toc-h4 .md-toc-inner {
  margin-left: 3em;
}

.md-toc-h5 .md-toc-inner {
  margin-left: 4em;
}

.md-toc-h6 .md-toc-inner {
  margin-left: 5em;
}

#typora-sidebar {
  border-right: var(--window-border);
}

.sidebar-tab {
  text-transform: none;
  font-weight: 700;
  font-size: 1.1em;
}

.md-search-hit {
  color: var(--search-hit-text-font-color);
  background-color: var(--search-hit-text-bg-color);
}

#md-searchpanel {
  box-shadow: none;
  filter: var(--tw-drop-shadow-md);
}

#md-searchpanel .btn:not(.close-btn):hover {
  box-shadow: none;
  -webkit-box-shadow: none;
  background-color: var(--tw-button-hover-bg);
}

#md-searchpanel input,
#md-searchpanel .btn,
#searchpanel-msg {
  border-radius: 5px;
}

#searchpanel-msg {
  color: var(--theme-500);
  border-color: var(--theme-300);
  background: var(--theme-100);
}

.form-control {
  border-color: var(--panel-border-color);
}

.btn-default {
  background-color: var(--button-bg);
}


code {
  font-family: Menlo, Monaco, Consolas, Courier New, monospace;
  word-break: break-word;
  border-radius: .125rem;
  overflow-x: auto;
  background-color: #fff5f5;
  color: #ff502c;
  font-size: 0.87em;
  padding: 0.065em 0.4em;
}

a {
  text-decoration: none;
  color: #0269c8;
  border-bottom: 1px solid #d1e9ff;
}

code::before {
  content: none;
}

code::after {
  content: none;
}

#write {
  font-size: 16px;
  line-height: 26px;
  max-width: 928px;
}

@media only screen and (min-width: 87.5rem) {
  #write {
    max-width: 1024px;
  }
}

@media only screen and (min-width: 112.5rem) {
  #write {
    max-width: 1200px;
  }
}
p {
  line-height: inherit;
    margin-top: 22px;
    margin-bottom: 22px;
}
h1 {
  font-size: 2.5rem;
  line-height: 2.75rem;
  margin-bottom: 1.5rem;
  letter-spacing: -0.0938rem;
}

h2 {
  font-size: 1.375rem;
  line-height: 2.125rem;
  padding-bottom: .75rem;
  border-bottom: .0625rem solid #ececec;
  font-weight: bold;
}

h3 {
  font-size: 1.25rem;
  line-height: 1.75rem;
  margin-top: 2.1875rem;
  margin-bottom: .625rem;
  padding-bottom: .3125rem;
}

h4 {
  font-size: 1.125rem;
  line-height: 1.625rem;
  margin-top: 2.1875rem;
  margin-bottom: .625rem;
  padding-bottom: .3125rem;
  font-weight: bold;
}

h5 {
  font-size: 15.52px;
  line-height: 20px;
  margin-bottom: 24px;
  font-weight: bold;
}

h6 {
  font-size: 14.88px;
  line-height: 16px;
  margin-bottom: 12px;
}

pre,
code,
kbd,
tt,
var {
  font-size: 0.875em;
}

blockquote {
  color: #666;
  padding: 10px 23px;
  margin: 22px 0;
  border-left: 4px solid #cbcbcb;
  background-color: #f8f8f8;
  font-style: normal;
}

blockquote p {
  margin: 10px 0;
}

img {
  border-radius: 1.25rem;
  float: left;
}

ul {
  padding: 0;
  margin: 0;
  padding-left: 1.75rem;
}
ul > li::marker {
  color: black;
  margin-bottom: 0;
}
ol > li::marker {
  color: black;
  margin-bottom: 0;
}

</style>

<title>PromptEngineeringGuide</title>

<style>

  /* 内容区域样式 */
  .typora-export-content {
    max-width: 900px; /* 最大宽度，控制所有内容的宽度 */
    margin-top: 80px;
    margin: 76px auto; /* 上下外边距10px，左右自动居中 */
    padding: 0 20px; /* 上下内边距为0，左右内边距为20px */
    background-color: white; /* 内容背景色 */
    border-radius: 8px; /* 圆角边框 */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* 阴影效果 */
    transform: translateX(18px);
  }

  body {
    background-color: #ffffff;
  }

  .smaller-title {
    font-size: 1.5em; /* 你可以根据需要调整字体大小 */
    text-align: center; /* 居中处理 */
  }

  /* 图片容器样式 */
  .image-container {
    display: flex;
    flex-direction: column;
    align-items: center; /* 确保图片居中 */
    width: 100%;
    margin: 20px 0;
}

.image-container img {
  width: 100%; /* 图片宽度占满容器 */
  max-width: 550px; /* 设置图片的最大宽度 */
  height: auto; /* 保持宽高比 */
  display: block; /* 确保图片自身是块级元素 */
  margin: 0 auto; /* 在容器内居中图片 */
}

  /* 段落和标题样式 */
  .typora-export-content p,
  .typora-export-content h2,
  .typora-export-content ul {
    margin: 0 0 20px; /* 下边距 */
  }

  /* 列表样式 */
  .typora-export-content ul {
    padding-left: 20px;
  }

  #author {
    text-align: center; /* 文本居中 */
    display: block; /* 确保它是一个块级元素 */
    font-family: "Microsoft YaHei", sans-serif; /* 设置微软雅黑字体 */
    text-decoration: underline; /* 添加下划线 */
    color: gray; /* 设置文字颜色为灰色 */
  }

  #post_time {
    text-align: center; /* 文本居中 */
    display: block; /* 确保它是一个块级元素 */
    font-family: "Microsoft YaHei", sans-serif; /* 设置微软雅黑字体 */
    color: gray; /* 设置文字颜色为灰色 */
  }


</style>


</head>
<body class='typora-export os-windows'>
  <div class='typora-export-content'>
    <div id='write'>
      <h1 id='title' class='smaller-title'><span>精读 · AI Agent —— 从理解到实现</span></h1></br>
      <p id = 'author'><span>原创作者：周锦弘</span></p>
      <p id = 'post_time'><span>@ 2024/11/11</span></p></br>
      <p><em><span>“AI Agent” 一词最近在很多行业里变得越来越热门，可你知道它到底是什么意思吗？</span></em></p>
      <p>&nbsp;</p>
      <p><strong><span>Agent</span></strong><span>
          一词源自哲学，原指具有行动能力的实体，狭义上表示拥有意图和行动力的“代理人”。这个概念不仅限于人类，还包括物理和虚拟世界的各种实体，强调自主性和决策能力，而非单纯的被动反应。</span></p>
      <p>&nbsp;</p>
      <p><span>在人工智能领域，Agent 是一种计算实体。由于“意识”和“欲望”对计算实体而言过于形而上，许多 AI 研究者（包括艾伦.图灵）主张暂时搁置 Agent 是否“真正”思考的讨论，专注于其行为表现。目前，AI
          Agent 的称呼尚未统一，常见名称包括</span><strong><span>“AI代理” 、“智能代理” 或 “智能体”</span></strong><span> 等。</span></p>
      <p>&nbsp;</p>
      <div class="image-container">
        <img src="https://jacksonzjh.github.io/ai-tech/Ai-TechArticles/AiAgent/images/p1.png" alt="Image Description">
      </div>
      <p style="color: #b3b3b3; text-align: center; margin-top: 8px;">
        <span><u>基于 AI 大模型的智能体架构</u></span>
      </p>
      <p>&nbsp;</p>
      <h2 id='本文关键词'><span>本文关键词</span></h2>
      <figure>
        <table>
          <thead>
          </thead>
          <tbody>
            <tr>
              <td style="text-align:left;"><span>AI Agent</span></td>
              <td style="text-align:left;"><span>一种能够感知环境、进行决策和执行动作的智能实体。</span></td>
            </tr>
            <tr>
              <td><span>LLM</span></td>
              <td style='text-align:left;'><span>大型语言模型 / AI大模型，它使用深度学习技术和超大规模的大型数据集，用于理解、总结、生成和预测推理。</span></td>
            </tr>
            <tr>
              <td><span>RPA</span></td>
              <td style='text-align:left;'><span>机器人流程自动化，是一种软件自动化技术。通过模仿人类在电脑上的手动操作，如打开网站、点击鼠标、键盘输入等，实现业务流程的自动化。</span>
              </td>
            </tr>
            <tr>
              <td><span>Copilot</span></td>
              <td style='text-align:left;'><span>“副驾驶”，这里 Copilot
                  指依托于底层大语言模型（LLM），用户只需说几句话，做出指示，它就可以创建类似人类撰写的文本和其他内容。</span></td>
            </tr>
            <tr>
              <td><span>LangChain</span></td>
              <td style='text-align:left;'><span>一种大型语言模型集成框架，构建端到端的应用程序，它提供了一套工具、组件和接口，可简化创建由 LLM 和聊天模型提供支持的应用程序。</span>
              </td>
            </tr>
            <tr>
              <td><span>Short-term memory</span></td>
              <td style='text-align:left;'><span>短期 / 临时记忆，能够使 LLM 暂时存储和处理少量信息。</span></td>
            </tr>
            <tr>
              <td><span>Long-term memory</span></td>
              <td style='text-align:left;'><span>长期 / 永久记忆，能够存储经验、知识和技能，而且这个存储时间可以非常长，LLM 一般通过外部向量存储和快速检索实现。</span></td>
            </tr>
            <tr>
              <td><span>CoT</span></td>
              <td style='text-align:left;'><span>一种高级的提示工程技术，用于提高 LLM 在复杂任务中的表现。LLM 被要求 “一步一步地思考”，将艰巨的任务分解为更小更简单的步骤。</span>
              </td>
            </tr>
            <tr>
              <td><span>ReAct</span></td>
              <td style='text-align:left;'><span>将任务中单独的行为和语言空间组合在一起，从而使 LLM 的推理和行动融为一体。该模式帮助 LLM 与环境互动（例如：使用互联网搜索引擎的
                  API），并以自然语言留下推理的痕迹。主要包括：Thought：Action\Observation。</span></td>
            </tr>
          </tbody>
        </table>
      </figure>
      <p>&nbsp;</p>
      <h2 id='什么是-ai-agent理解）'><span>什么是 AI Agent（理解）</span></h2>
      <p><span>AI Agent（人工智能代理）是一种能够感知环境、进行决策和执行动作的智能实体。 不同于传统的人工智能， AI Agent 具备通过独立思考、调用工具去逐步完成给定目标的能力。比如，我们告诉 某某 AI Agent
          帮忙下单一份外卖，它就可以直接调用 APP 选择外卖，再调用支付程序下单支付，无需人类去指定每一步的操作。</span></p>
      <p>&nbsp;</p>
      <p><span>ChatGPT 诞生后， AI 从真正意义上具备了和人类进行多轮对话的能力，并且能针对相应问题给出具体回答与建议。随后各种 </span><strong><span>“Copilot”
            AI助手</span></strong><span>应用的推出，如 </span><strong><span>GitHub Copilot、 通义灵码、Cursor、v0.dev、
            Bolt.new</span></strong><span> 等，让 AI 成为了办公、代码、设计等场景的“智能副驾驶”。</span></p>
      <p><strong><span>AI Agent 与 LLM 的区别在于：</span></strong></p>
      <ul>
        <li><span>LLM 与人类之间的交互是基于提示词（Prompt）实现的，用户写的Prompt是否清晰明确会影响回答的效果，例如 ChatGPT 和这些 Copilot 都需要明确任务才能得到有用的回答。</span>
        </li>
        <li><span>AI Agent 的工作仅需给定一个目标，它就能够针对目标独立思考并做出行动，它会根据给定任务详细拆解出每一步的计划步骤，依靠来自外界的反馈和自主思考，自己给自己创建Prompt，来实现目标。如果说
            Copilot 是 “副驾驶”，那么 Agent 则算得上一个初级的 “主驾驶”。</span></li>
      </ul>
      <p>&nbsp;</p>
      <p><strong><span>AI Agent 和传统的 RPA 相比：</span></strong><span>RPA 只能在给定的情况条件下，根据程序内预设好的流程来进行工作的处理，在出现大量未知信息、难以预测的环境中时，
          RPA 是无法进行工作的， AI Agent 则可以通过和环境进行交互，感知信息并做出对应的思考和行动。</span></p>
      <p>&nbsp;</p>
      <p><span>AI Agent 往往以问答机器人（Chat Bot）作为交互入口，通过自然语言触发全自动的工作流，中间没有人工介入。由于人只负责发送指令，并不参与对结果的反馈。</span></p>
      <p>&nbsp;</p>
      <h2 id='为什么需要-ai-agent'><span>为什么需要 AI Agent</span></h2>
      <p><strong><span>LLM 的一些缺点：</span></strong></p>
      <ol start=''>
        <li><span>会产生幻觉（一本正经的胡说八道），结果并不总是真实的</span></li>
        <li><span>对时事的了解有限或一无所知</span></li>
        <li><span>很难应对复杂的计算</span></li>
        <li><span>没有行动能力</span></li>
        <li><span>没有长期记忆能力</span></li>
      </ol>
      <p>&nbsp;</p>
      <p><span>例如，如果让聊天机器人（基于LLM） 买一杯咖啡，它的回答通常会是“我无法购买咖啡，因为我只是一个文字AI助手。”但如果是让基于 AI Agent
          的聊天机器人购买咖啡，它会首先分解任务，确定如何完成购买，并规划出步骤，如通过某个APP下单、支付等。接着，AI Agent会自动调用APP选择外卖、下单并支付，无需人类干预。这就是 AI Agent
          的优势所在：利用外部工具突破限制。</span></p>
      <p>&nbsp;</p>
      <p><span>这些工具是什么呢？</span><strong><span>工具是Agent用来完成任务的插件、集成API、代码库</span></strong><span>，例如：</span></p>
      <ul>
        <li><span>Google搜索：用于获取互联网信息</span></li>
        <li><span>Code Interpreter：代码解释器</span></li>
        <li><span>外部API：获取特定信息</span></li>
      </ul>
      <p>&nbsp;</p>
      <p><span>LangChain 则是提供一种通用的框架通过大语言模型的指令来轻松地实现这些工具的调用。当需要执行复杂任务时，我们往往需要将其拆解成多个子任务逐步完成，而 AI Agent
          正是为此而生。其主要类别包括“行动型”和“规划执行型” Agent。简而言之，AI Agent 结合 LLM 的自动化思维、规划、验证与执行能力，以实现特定任务目标。LLM 可视为“大脑”，而 AI Agent
          则是执行任务的“小脑”和“手脚”。</span></p>
      <p>&nbsp;</p>
      <div class="image-container">
        <img src="https://jacksonzjh.github.io/ai-tech/Ai-TechArticles/AiAgent/images/p2.png" alt="Image Description">
      </div>
      <p style="color: #b3b3b3; text-align: center; margin-top: 8px;">
        <span><u>AI Agent 的组成部分</u></span>
      </p>
      <p>&nbsp;</p>
      <h2 id='ai-agent-核心技术原理'><span>AI Agent 核心技术原理</span></h2>
      <p><span>前文介绍了AI Agent的概念及一些案例演示，接下来将深入探讨AI Agent背后的技术原理。</span></p>
      <p>&nbsp;</p>
      <p><span>一个基于LLM 的 AI Agent 系统通常由四个核心组件构成：大模型、规划、记忆和工具使用。OpenAI 应用研究主管 Lilian Weng 最早提出了一种基础架构：</span><strong><span><code>AI
            Agent = LLM + 规划能力 + 记忆 + 工具使用</code></span></strong><span> 在这一体系中，大模型（LLM）作为 AI Agent 的“大脑”，提供推理和规划能力。</span></p>
      <p>&nbsp;</p>
      <p><strong><span>AI Agent 的大脑：LLM 的规划决策能力</span></strong></p>
      <p><span>LLM 本身具备逻辑推理能力，AI
          Agent 可以通过适当的方式激发出这种能力。当模型参数量规模足够庞大时，LLM 本身已具备出色的推理能力，尤其是在简单推理问题上表现良好，但在处理复杂推理时偶尔会出错。很多用户之所以得不到理想答案，往往是因为提示词（Prompt）写的不够精准详细，未能充分激发LLM的推理潜力。</span>
      </p>
      <p>&nbsp;</p>
      <p><span>在论文《Large language models are zero-shot reasoners》的测试中，通过在提问时追加 </span><strong><span>“<u>Let’s think step by
            step</u>”</span></strong><span> 一语，LLM 在数学推理测试集GSM8K上的准确率从10.4%提升至40.7%。作为智能体的 AI Agent 能够自动创建合适的 Prompt，以更好地激发大模型的推理能力。</span></p>
      <p>&nbsp;</p>
      <p><strong><span>复杂任务通常由多个步骤组成</span></strong><span>，AI Agent 需要首先拆解并提前规划这些步骤。任务分解可以通过三种方式进行：</span></p>
      <p><span>1）在大模型中输入简单提示，如“XYZ 的步骤”或“实现 XYZ 的子目标是什么？”；</span></p>
      <p><span>2）使用特定指令，如写小说时要求大模型“写一个故事大纲”；</span></p>
      <p><span>3）由人工提供信息，使用当前主流的提示技术模式包括 </span><strong><span>思维链（CoT）和思维树（ToT）</span></strong><span>。</span></p>
      <p>&nbsp;</p>
      <p><strong><span>CoT 思维链（Chain of Thoughts）</span></strong></p>
      <p><span>回顾在我们发表的第一篇头条文章：从零到精通提示工程 中，我们提到了 CoT 是一种高级提示工程技术，用于提高 LLM 在复杂任务中的表现。LLM 被要求
          “一步一步地思考”，将艰巨的任务分解为更小更简单的步骤，将大任务转化为多个可管理的任务，并帮助人们理解 LLM 的思维过程。</span></p>
      <p>&nbsp;</p>
    <blockquote>
      <div style="font-family: Arial, sans-serif; line-height: 1.5;">
        <p><strong>Prompt:</strong></p>
        <p>问：丽莎有7支画笔，她又买了两盒画笔，每盒有2支画笔。她现在有多少支画笔？</p>
        <p>答：答案是11</p>
        <p>问：图书馆有23本书，借出去20本后又购入6本。现在图书馆有多少本书？</p>
        <p><strong>LLM:</strong></p>
        <p>答：答案是27</p>
      </div>
    </blockquote>
    <p>&nbsp;</p>
      <p><span>可以看到，LLM 未能给出正确的答案。但如果我们给模型一些解题思路，就像在数学考试中书写解题过程以确保得分一样，它可以更好地理解并得出正确答案。CoT 提示就是在帮助 LLM
          梳理解题步骤，以下是一个示例：</span></p>
          <blockquote>
            <div style="font-family: Arial, sans-serif; line-height: 1.5; margin: 0;">
              <p><strong>Prompt (CoT):</strong></p>
              <p>问：丽莎有7支画笔，她又买了两盒画笔，每盒有2支画笔。她现在有多少支画笔？</p>
              <p>答：丽莎一开始有7支画笔，两盒每盒2支画笔，一共就是2*2=4支，7+4=11。答案是11。</p>
              <p>问：图书馆有23本书，借出去20本后又购入6本。现在图书馆有多少本书？</p>
              <p><strong>LLM:</strong></p>
              <p>答：图书馆原来有23本书，借出20本，所以剩下23-20=3本。他们又购入6本，因此现在有6+3=9本。答案是9。</p>
            </div>
          </blockquote>
          
      <p>&nbsp;</p>
      <p><span>可以看到，类似的算术题，思维链提示会在给出答案之前，还会自动给出推理步骤。思维链提示，就是把一个多步骤推理问题，分解成很多个中间步骤，分配给更多的计算量，生成更多的
          token，再把这些答案拼接在一起进行求解。</span></p>
      <p>&nbsp;</p>
      <p><strong><span>思维树（Tree of Thoughts）</span></strong></p>
      <p><span>思维树提示通过任务的每一步中探索多种推理路径来扩展思维链。它将问题分解为多个思考步骤，并在每一步生成多个可能的想法，从而形成树状结构。搜索过程可采用广度优先搜索（BFS）或深度优先搜索（DFS）策略。ToT
          涉及四个关键步骤：思想分解、思想生成、状态评估和搜索算法。</span></p>
      <p>&nbsp;</p>
      <p><strong><span>ToT 提示词的例子如下：</span></strong></p>
      <blockquote>
        <p><strong>Prompt (ToT)： </strong></p>
      假设三位不同的专家来回答这个问题。所有专家都写下他们思考这个问题的第一个步骤，然后与大家分享。然后，所有专家都写下他们思考的下一个步骤并分享。以此类推，直到所有专家写完他们思考的所有步骤。只要大家发现有专家的步骤出错了，就让这位专家离开。请问...
      </blockquote>
    <p>&nbsp;</p>
    <div class="image-container">
      <img src="https://jacksonzjh.github.io/ai-tech/Ai-TechArticles/AiAgent/images/p3.png" alt="Image Description">
    </div>
    <p style="color: #b3b3b3; text-align: center; margin-top: 8px;">
      <span><u>ToT 相比 CoT 提示方法获得的准确率大大提高</u></span>
    </p>
    <p>&nbsp;</p>
    <p>
      <span>另一方面，</span><strong><span>试错和纠错</span></strong><span>在现实世界的任务决策中是不可避免且至关重要的步骤。</span><strong><span>自我反思</span></strong><span>可以帮助
        AI Agent 完善过去的行动决策、纠正以前的错误、从而不断改进。最具代表的技术包括：</span><strong><span>ReAct</span></strong><span>。</span></p>
    <p>&nbsp;</p>
    <p><strong><span>AI Agent 经典框架：ReAct（反思与改善）</span></strong></p>
    <p><span>虽然 CoT 提示在提升 LLM 的回答质量方面表现出色，但需要注意的是，LLM 每次只能回答一个独立的问题。也就是说，即使 CoT
        能够实现链式思考，它也仅限于单个问题的解答。对于一些简单的对话场景，这样的能力可能已足够，但在面对需要多重思考、并涉及多个问题的复杂情境时，CoT 的能力就显得不足了。</span></p>
    <p>&nbsp;</p>
    <p><span>以下是一个示例，与 Kimi（moonshot-v1-8k）语言模型的对话：</span></p>
    <blockquote>
      <div style="font-family: Arial, sans-serif; line-height: 1.5; margin: 0;">
        <p><strong>Prompt：</strong>windows 系统为什么突然连不上 wifi 了？Let’s think step by step</p>
        <p><strong>LLM：</strong>当然，我们可以一步一步地分析和解决 Windows 系统突然连不上 Wi-Fi 的问题：</p>
        <p>第一步：检查基本硬件和物理开关<br>
           检查 Wi-Fi 硬件开关：确保你的电脑的 Wi-Fi 硬件开关是开启的。有些笔记本电脑有物理开关或键盘快捷键（如 Fn + 功能键）来控制 Wi-Fi。<br>
           检查无线网卡：如果电脑有内置无线网卡，确保它没有被禁用。</p>
        <p>第二步：检查 Wi-Fi 信号和路由器状态<br>
           检查 Wi-Fi 信号：确保你的设备在 Wi-Fi 信号覆盖范围内。<br>
           检查路由器：确认路由器或调制解调器是否正常工作，重启路由器可能会有帮助。</p>
        <p>第三步：检查操作系统设置<br>
           检查 Wi-Fi 服务：确保 “WLAN AutoConfig” 服务正在运行。可以在 “服务” 中找到并启动它。<br>
           检查网络适配器：在“设备管理器”中检查 Wi-Fi 适配器是否被禁用或有问题。<br>
           检查飞行模式：确保 Windows 没有被设置为“飞行模式”。</p>
        <p>......</p>
        <p>通过这些步骤，我们可以系统地排查和解决 Windows 系统突然连不上 Wi-Fi 的问题。希望这些步骤能帮助你解决问题。如果需要更具体的指导，请提供更多的错误信息或症状。</p>
      </div>
    </blockquote>    
    <p>&nbsp;</p>
    <p><span>根据 LLM 的回答中故障原因排查列表，</span><strong><span>我们需要自己去检查回答中的一项或者多项（反馈结果）</span></strong><span>，然后告诉大模型是否找到了原因：</span>
    </p>
    <blockquote>
      <div style="font-family: Arial, sans-serif; line-height: 1.5; margin: 0;">
        <p><strong>Prompt：</strong>网络配置是正确的</p>
        <p><strong>LLM：</strong></p>
        <p>如果网络配置是正确的，那么我们可以继续排查其他可能的问题。以下是一些进一步的步骤：</p>
        <p>第一步：检查 Wi-Fi 信号和路由器状态<br>
           Wi-Fi 信号强度：确保你的设备在 Wi-Fi 信号覆盖范围内，并且信号强度足够。<br>
           路由器状态：检查路由器的指示灯或状态页面，确保路由器正常工作，没有显示错误或警告。</p>
        <p>第二步：检查操作系统设置<br>
           Wi-Fi 服务：确保“WLAN AutoConfig”服务正在运行。可以在“服务”中找到并启动它。<br>
           飞行模式：确保 Windows 没有被设置为“飞行模式”。</p>
        <p>......</p>
        <p>如果以上步骤都不能解决问题，可能需要更专业的技术支持。你可以考虑联系你的网络服务提供商或者电脑制造商的客服，他们可能会提供更具体的诊断和解决方案。</p>
      </div>
    </blockquote>    
    <p>&nbsp;</p>
    <p><span>以此类推。这个示例的问答，是一个CoT过程。每一次 LLM 只会输出一个答案（一段文本），参考我们提供给它的检查结果，结合自身的知识训练，从而返回一次的响应。</span></p>
    <p>&nbsp;</p>
    <p><span>ReAct 是一种方法，通过多次调用 LLM
        以交错的方式生成推理轨迹和特定于任务的动作，从而实现两者之间更大的协同作用：推理轨迹帮助模型归纳、跟踪和更新行动计划以及处理异常，而操作允许它与外部源（例如知识库或外部环境、API）交互，以收集附加信息。</span></p>
    <p>&nbsp;</p>
    <p><span>ReAct 技术通过</span><strong><span>不断迭代三类核心元素</span></strong><span>来实现任务完成：</span></p>
    <ol start=''>
      <li><strong><span>Thought（思考）</span></strong><span>：LLM 基于用户提出的问题进行推理，得出合理的行动方向，类似人类思考和决策的过程。</span></li>
      <li><strong><span>Action（行为）</span></strong><span>：根据推理结果，LLM 生成指令并发送给外部资源（如知识库或 API），执行该指令。</span></li>
      <li><strong><span>Observation（观察）</span></strong><span>：行为产生的结果会被 LLM 记录和观察。</span></li>
    </ol>
    <p>&nbsp;</p>
    <p><span>LLM在每一步汇总用户的问题以及当前的 Thought、Action 和 Observation，进行新的推理，从而产生下一步的
        Thought、Action和Observation。这个过程循环进行，直到行动流程结束。以下是具体的迭代步骤：</span></p>
    <ul>
      <li><strong><span>Step 1</span></strong><span>：LLM 基于问题推理并决定行动，生成 </span><strong><span>Thought
            1</span></strong><span> 和 </span><strong><span>Action 1</span></strong><span>，执行Action 1后获得
        </span><strong><span>Observation 1</span></strong><span>。</span></li>
      <li><strong><span>Step 2</span></strong><span>：LLM 基于问题、Thought 1、Action 1和 Observation 1 进行推理，生成
        </span><strong><span>Thought 2</span></strong><span> 和 </span><strong><span><strong>Action 2</strong></span></strong><span>，执行 Action
          2 后获得 </span><strong><span>Observation 2</span></strong><span>。</span></li>
      <li><strong><span>Step 3</span></strong><span>：LLM 汇总问题、所有之前的 Thought、Action 和 Observation，再次推理，生成
        </span><strong><span>Thought 3</span></strong><span> 和 </span><strong><span>Action 3</span></strong><span>，执行 Action
          3 后获得 </span><strong><span>Observation 3</span></strong><span>。</span></li>
    </ul>
    <p>&nbsp;</p>
    <p><u><span>这一过程持续循环，直到 LLM 通过 Action 确定任务完成</u>。</span></p>
    <p>&nbsp;</p>
    <p><span>AI Agent 自主发现了问题原因，通过 ReAct 方法逐步检查并调整操作，最终准确找出是系统更新导致 WiFi 无法连接。</span></p>
    <blockquote>
      <div style="font-family: Arial, sans-serif; line-height: 1.5; margin: 0;">
        <p><span><strong>LLM：</strong> windows 系统为什么突然连不上 wifi 了？</span></p>
        <p><span><strong>LLM (ReAct)：</strong></span></p>
        <p><span>想法1：检查 WiFi 是否被禁用。</span><br>
           <span>动作1：检查 WiFi 开关状态。</span><br>
           <span>结果1：WiFi 已启用。</span>
        </p>
        <p><span>===========</span></p>
        <p><span>想法2：WiFi 正常启用，但仍然无法连接，可能是网络适配器问题。</span><br>
           <span>动作2：检查网络适配器状态。</span><br>
           <span>结果2：网络适配器驱动正常。</span>
        </p>
        <p><span>===========</span></p>
        <p><span>想法3：适配器正常，但系统最近更新可能导致兼容性问题。</span><br>
           <span>动作3：检查系统更新记录。</span><br>
           <span>结果3：系统确实在近期更新。</span>
        </p>
        <p><span>===========</span></p>
        <p><span>想法4：我需要卸载最近的更新，看看问题是否解决。</span><br>
           <span>动作4：卸载最新更新。</span>
        </p>
        <p><span>===========</span><br>
           <span>问题来源已找到：系统更新引起的 WiFi 连接问题。</span>
        </p>
      </div>
    </blockquote>    
    <p>&nbsp;</p>
    <div class="image-container">
      <img src="https://jacksonzjh.github.io/ai-tech/Ai-TechArticles/AiAgent/images/p4.png" alt="Image Description">
    </div>
    <p>&nbsp;</p>
    <p><span>当然，ReAct 框架下的 AI Agent 也是有</span><strong><span>缺点</span></strong><span>的：</span></p>
    <ul>
      <li><span>完成 k 步，长度很长需要较大的上下文窗口，需要</span><strong><span>消耗大量 LLM 的推理 token</span></strong><span>；</span></li>
      <li><span>由于工具种类的多样以及</span><strong><span>输出的不稳定</span></strong><span>，在 LLM
          被广泛使用的指令微调在增强式语言模型中很难倾泄可范化性的工具使用能力到小模型上。</span></li>
    </ul>
    <p>&nbsp;</p>
    <p><strong><span>记忆：用有限的上下文长度实现更多的记忆</span></strong></p>
    <p><span>记忆模块在智能体中用于存储信息，包括以往的交互、知识以及临时任务信息，使其在面对复杂情境时能调用先前的经验。例如，具备记忆功能的聊天机器人能记住用户的偏好和对话内容，提供更连贯的交流体验。</span></p>
    <p>&nbsp;</p>
    <p><span>与人类记忆一一对应。人类的感觉记忆、短期记忆、长期记忆在 AI Agent
        中则分别表现为用户的提示输入（Prompt）、上下文窗口和外部向量数据库。记忆模块能存储任务信息，帮助智能体在对话中更精准地提供相关上下文。</span></p>
    <p>&nbsp;</p>
    <p><span>为解决有限记忆的限制，通常借助向量数据库实现高效存储和检索，</span><strong><span>可以参考回顾我们发布的往期文章：</span></strong><span>检索增强生成（RAG）技术详解。向量数据库通过将非结构化数据（如文本、图像）转化为向量并存储，支持快速相似度检索。这种结构降低了存储和计算成本，比传统神经网络节省2至4个数量级的成本。Embedding
        技术和向量相似度计算是其核心，通过将数据转化为多维向量、计算相似性，向量数据库实现了模糊匹配和高效检索。</span></p>
    <p>&nbsp;</p>
    <p><strong><span>工具调用：懂得使用工具才会更像人类</span></strong></p>
    <p><span>AI Agent 与 LLM 的显著区别在于其使用外部工具来扩展模型的能力。人类的独特之处在于善于使用工具，而 AI Agent
        则具备了自主调用工具的能力。在处理每一步子任务时，智能体会判断是否需要调用外部工具，完成任务后将工具返回的信息提供给 LLM，以进行下一步工作。</span></p>
    <p>&nbsp;</p>
    <p><span>如今，AI 开发者可以向大模型描述函数，模型可智能生成包含调用这些函数参数的 JSON 对象，从而更可靠地连接 LLM 与外部工具或 API。</span></p>
    <p>&nbsp;</p>
    <p><strong><span>总结一下：</span></strong></p>
    <p><span>AI Agent 的基本原理包含四大核心能力：感知、分析、决策和执行。首先，感知能力通过传感器获取外部环境信息，使 Agent
        对周围情况有所了解。其次，分析能力对所感知的信息进行处理，从中提取关键特征和模式。接着，决策能力基于分析结果制定行动计划。最后，执行能力将决策转化为具体行动，完成任务。</span></p>
    <p>&nbsp;</p>
    <p><em><strong><span>接下来，我们会展示如何实现基于 LLM、可使用外部工具的 AI Agent 的完整流程。</span></strong></em></p>
    <p>&nbsp;</p>
    <div class="image-container">
      <img src="https://jacksonzjh.github.io/ai-tech/Ai-TechArticles/AiAgent/images/p5.png" alt="Image Description">
    </div>
    <p style="color: #b3b3b3; text-align: center; margin-top: 8px;">
      <span><u>我们将使用 Langchain 编程框架来实现智能体的整个搭建流程</u></span>
    </p>
    <p>&nbsp;</p>
    <h2 id='手把手从-0-到-1-搭建实现）'><span>手把手从 0 到 1 搭建（实现）</span></h2>
    <p><span>我们将展示用</span><strong><span>全代码</span></strong><span>（LangChain）的方式构建一个</span><code><span>能帮忙买火车票</code> 的 AI
          Agent</span><span>，采用 ReAct 经典框架。</span>
      <em><span>注：火车购票的相关 API 均为伪数据</span></em>
    </p>
    <p>&nbsp;</p>
    <p><span>搭建一个 ReAct 框架的 AI Agent 我们需要准备以下几样东西：</span></p>
    <ul>
      <li><span>Models：某开源 LLM</span></li>
      <li><span>Prompts：对 AI Agent 的指令、约束</span></li>
      <li><span>Memory : 记录 Action 执行状态 &amp; 缓存已知信息</span></li>
      <li><span>Indexes : 用于结构化文档，以便和 LLM 交互</span></li>
      <li><span>Chains ：Langchain 的核心（链）</span></li>
    </ul>
    <p>&nbsp;</p>
    <p><strong><span>① 安装与导入必要依赖</span></strong></p>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"
      style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 12px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
      <div class="CodeMirror-activeline" style="position: relative;">
        <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
        <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
        <pre class=" CodeMirror-line "
          role="presentation"><span role="presentation" style="padding-right: 0.1px;">pip install langchain</span></pre>
      </div>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">pip install uuid</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">pip install pydantic</span></pre></br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">import json</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">import sys</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from typing import List, Optional, Dict, Any, Tuple, Union</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from uuid import UUID</span></pre></br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from langchain.memory import ConversationTokenBufferMemory</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from langchain.tools.render import render_text_description</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from langchain_core.callbacks import BaseCallbackHandler</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from langchain_core.language_models import BaseChatModel</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from langchain_core.output_parsers import PydanticOutputParser, StrOutputParser</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from langchain_core.outputs import GenerationChunk, ChatGenerationChunk, LLMResult</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from langchain_core.prompts import PromptTemplate</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from langchain_core.tools import StructuredTool</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from langchain_openai import ChatOpenAI</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from pydantic import BaseModel, Field, ValidationError</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 644px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 644px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <p><strong><span>② 编写 ReAct Agent 的 prompt template（提示模板）</span></strong></p>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""
      style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 12px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
      <div class="CodeMirror-activeline" style="position: relative;">
        <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
        <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
        <pre class=" CodeMirror-line "
          role="presentation"><span role="presentation" style="padding-right: 0.1px;">from langchain_core.prompts import PromptTemplate</span></pre>
      </div></br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">template = '''尽你所能回答以下问题。你可以使用以下工具：</span></pre></br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">{tools}</span></pre></br>

      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">请使用以下格式：</span></pre>

      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">Question: 你必须回答的输入问题</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">Thought: 你应该始终思考该怎么做</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">Action: 要采取的行动，应该是 [{tool_names}] 之一</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">Action Input: 行动的输入</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">Observation: 行动的结果</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">...（这个 Thought/Action/Action Input/Observation 可以重复 N 次）</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">Thought: 现在我知道最终答案了</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">Final Answer: 原始输入问题的最终答案</span></pre></br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">Begin!</span></pre></br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">Question: {input}</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">Thought:{agent_scratchpad}'''</span></pre></br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">prompt = PromptTemplate.from_template(template)</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 672px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 672px;"></div>
    </div>
    </div>
    </pre>
    <p><em><span>在 Langchain 中，提示模板用于全局定义 Agent 的执行逻辑，如：ReAct 框架</span></em></p>
    <p>&nbsp;</p>
    <p><strong><span>③ 定义 Tools（可以使用的工具）</span></strong></p>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"
      style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 12px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
      <div class="CodeMirror-activeline" style="position: relative;">
        <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
        <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
        <pre class=" CodeMirror-line "
          role="presentation"><span role="presentation" style="padding-right: 0.1px;">from typing import List</span></pre>
      </div>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">from langchain_core.tools import StructuredTool</span></pre>
      <pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">def search_train_ticket(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  origin: str,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  destination: str,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  date: str,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  departure_time_start: str,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  departure_time_end: str</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">) -&gt; List[dict[str, str]]:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  """按指定条件查询火车票"""</span></pre></br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  # mock train list</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  return [</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "train_number": "G1234",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "origin": "北京",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "destination": "武汉",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "departure_time": "2024-11-01 8:00",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "arrival_time": "2024-11-01 12:00",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "price": "100.00",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "seat_type": "二等座",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "train_number": "G5678",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "origin": "北京",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "destination": "武汉",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "departure_time": "2024-11-01 18:30",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "arrival_time": "2024-11-01 22:30",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "price": "100.00",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "seat_type": "二等座",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "train_number": "G9012",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "origin": "北京",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "destination": "武汉",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "departure_time": "2024-11-01 19:00",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "arrival_time": "2024-11-01 23:00",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "price": "100.00",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "seat_type": "二等座",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ]</span></pre></br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">def purchase_train_ticket(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  train_number: str,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">) -&gt; dict:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  """购买火车票"""</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  return {</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "result": "success",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "message": "购买成功",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "data": {</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "train_number": "G1234",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "seat_type": "二等座",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "seat_number": "7-17A"</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">search_train_ticket_tool = StructuredTool.from_function(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  func=search_train_ticket,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  name="查询火车票",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  description="查询指定日期可用的火车票。",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">)</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">purchase_train_ticket_tool = StructuredTool.from_function(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  func=purchase_train_ticket,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  name="购买火车票",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  description="购买火车票。会返回购买结果(result), 和座位号(seat_number)",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">)</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">finish_placeholder = StructuredTool.from_function(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  func=lambda: None,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  name="FINISH",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  description="用于表示任务完成的占位符工具"</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">)</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">tools = [search_train_ticket_tool, purchase_train_ticket_tool, finish_placeholder]</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 2268px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 2268px;"></div>
    </div>
    </div>
    </pre>
    <p><em><span>更多定义工具方法细节参考：</span><a
          href='https://python.langchain.com.cn/docs/modules/agents/tools/how_to/custom_tools' target='_blank'
          class='url'>https://python.langchain.com.cn/docs/modules/agents/tools/how_to/custom_tools</a></em></p>
    <p>&nbsp;</p>
    <p><strong><span>④ 编写一些方便编程的工具类</span></strong></p>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"
      style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 12px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
      <div class="CodeMirror-activeline" style="position: relative;">
        <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
        <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
        <pre class=" CodeMirror-line "
          role="presentation"><span role="presentation" style="padding-right: 0.1px;">class Action(BaseModel):</span></pre>
      </div>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  """结构化定义工具的属性"""</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  name: str = Field(description="工具或指令名称")</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  args: Optional[Dict[str, Any]] = Field(description="工具或指令参数，由参数名称和参数值组成")</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">class MyPrintHandler(BaseCallbackHandler):</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  """自定义LLM CallbackHandler，用于打印大模型返回的思考过程"""</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  def __init__(self):</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  BaseCallbackHandler.__init__(self)</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  def on_llm_new_token(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  self,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  token: str,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  *,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  chunk: Optional[Union[GenerationChunk, ChatGenerationChunk]] = None,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  run_id: UUID,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  parent_run_id: Optional[UUID] = None,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  **kwargs: Any,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ) -&gt; Any:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  end = ""</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  content = token + end</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  sys.stdout.write(content)</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  sys.stdout.flush()</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return token</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  def on_llm_end(self, response: LLMResult, **kwargs: Any) -&gt; Any:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  end = ""</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  content = "\n" + end</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  sys.stdout.write(content)</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  sys.stdout.flush()</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return response</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1008px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 1008px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <p><strong><span>⑤ 定义 Agent（基于 LLM）</span></strong></p>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="py"
      style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="py"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 12px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
      <div class="CodeMirror-activeline" style="position: relative;">
        <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
        <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
        <pre class=" CodeMirror-line "
          role="presentation"><span role="presentation" style="padding-right: 0.1px;">class MyAgent:</span></pre>
      </div>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  def __init__(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  self,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  llm: BaseChatModel = ChatOpenAI(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  model="某开源 LLM 名称（兼容OpenAI接口服务的都行）",  # 建议使用推理能力强的AI大模型效果更佳</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  temperature=0,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  model_kwargs={</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "seed": 42</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ),</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  tools=None,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  prompt: str = "",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  final_prompt: str = "",</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  max_thought_steps: Optional[int] = 10,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ):</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  if tools is None:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  tools = []</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  self.llm = llm</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  self.tools = tools</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  self.final_prompt = PromptTemplate.from_template(final_prompt)</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  self.max_thought_steps = max_thought_steps # 最多思考步数，避免死循环</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  self.output_parser = PydanticOutputParser(pydantic_object=Action)</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  self.prompt = self.__init_prompt(prompt)</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  self.llm_chain = self.prompt | self.llm | StrOutputParser() # 主流程的LCEL</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  self.verbose_printer = MyPrintHandler()</span></pre>
      <pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp;  def __init_prompt(self, prompt):</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return PromptTemplate.from_template(prompt).partial(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  tools=render_text_description(self.tools),</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  format_instructions=self.__chinese_friendly(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  self.output_parser.get_format_instructions(),</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  )</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  )</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  def run(self, task_description):</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>"""Agent主流程"""</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  # 思考步数</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  thought_step_count = 0</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  # 初始化记忆</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  agent_memory = ConversationTokenBufferMemory(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  llm=self.llm,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  max_token_limit=4000,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  )</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  agent_memory.save_context(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {"input": "\ninit"},</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {"output": "\n开始"}</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  )</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  # 开始逐步思考</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  while thought_step_count &lt; self.max_thought_steps:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  print(f"&gt;&gt;&gt;&gt;Round: {thought_step_count}&lt;&lt;&lt;&lt;")</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  action, response = self.__step(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  task_description=task_description,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  memory=agent_memory</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  )</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # 如果是结束指令，执行最后一步</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  if action.name == "FINISH":</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  break</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # 执行动作</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  observation = self.__exec_action(action)</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  print(f"----\nObservation:\n{observation}")</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # 更新记忆</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  self.__update_memory(agent_memory, response, observation)</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  thought_step_count += 1</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  if thought_step_count &gt;= self.max_thought_steps:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # 如果思考步数达到上限，返回错误信息</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  reply = "抱歉，我没能完成您的任务。"</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  else:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # 否则，执行最后一步</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  final_chain = self.final_prompt | self.llm | StrOutputParser()</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  reply = final_chain.invoke({</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "task_description": task_description,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "memory": agent_memory</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  })</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return reply</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  def __step(self, task_description, memory) -&gt; Tuple[Action, str]:</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  """执行一步思考"""</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  response = ""</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  for s in self.llm_chain.stream({</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "task_description": task_description,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "memory": memory</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }, config={</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "callbacks": [</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  self.verbose_printer</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ]</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }):</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  response += s</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  action = self.output_parser.parse(response)</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return action, response</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  def __exec_action(self, action: Action) -&gt; str:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  observation = "没有找到工具"</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  for tool in self.tools:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  if tool.name == action.name:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  try:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # 执行工具</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  observation = tool.run(action.args)</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  except ValidationError as e:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # 工具的入参异常</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  observation = (</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  f"Validation Error in args: {str(e)}, args: {action.args}"</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  )</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  except Exception as e:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # 工具执行异常</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  observation = f"Error: {str(e)}, {type(e).__name__}, args: {action.args}"</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return observation</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  @staticmethod</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  def __update_memory(agent_memory, response, observation):</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  agent_memory.save_context(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {"input": response},</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {"output": "\n返回结果:\n" + str(observation)}</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  )</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  @staticmethod</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  def __chinese_friendly(string) -&gt; str:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  lines = string.split('\n')</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  for i, line in enumerate(lines):</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  if line.startswith('{') and line.endswith('}'):</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  try:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  lines[i] = json.dumps(json.loads(line), ensure_ascii=False)</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  except:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  pass</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return '\n'.join(lines)</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 4228px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 4228px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <p><strong><span>⑥ 编写 Prompt（系统提示词 — 约束 Agent 的指令）</span></strong></p>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""
      style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 12px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
      <div class="CodeMirror-activeline" style="position: relative;">
        <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
        <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
        <pre class=" CodeMirror-line "
          role="presentation"><span role="presentation" style="padding-right: 0.1px;">prompt_text = """</span></pre>
      </div>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">你是强大的AI火车订票助手，可以使用工具与指令查询并购买火车票</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">你的任务是:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">{task_description}</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">你可以使用以下工具或指令，它们又称为动作或actions:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">{tools}</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">当前的任务执行记录:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">{memory}</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">按照以下格式输出：</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">任务：你收到的需要执行的任务</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">思考: 观察你的任务和执行记录，并思考你下一步应该采取的行动</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">然后，根据以下格式说明，输出你选择执行的动作/工具:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">{format_instructions}</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">"""</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">final_prompt = """</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">你的任务是:</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">{task_description}</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">以下是你的思考过程和使用工具与外部资源交互的结果。</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">{memory}</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">你已经完成任务。</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">现在请根据上述结果简要总结出你的最终答案。</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">直接给出答案。不用再解释或分析你的思考过程。</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;">"""</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 868px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 868px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <p><strong><span>⑦ 运行调试</span></strong></p>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
      lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 12px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
      <div class="CodeMirror-activeline" style="position: relative;">
        <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
        <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
        <pre class=" CodeMirror-line "
          role="presentation"><span role="presentation" style="padding-right: 0.1px;">if __name__ == "__main__":</span></pre>
      </div>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  my_agent = MyAgent(</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  tools=tools,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  prompt=prompt_text,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  final_prompt=final_prompt,</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  )</span></pre>
      </br>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  task = "帮我订一张2024年11月1日从北京去武汉的火车票，时间段不限"</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  reply = my_agent.run(task)</span></pre>
      <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  print(reply)</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 308px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 308px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <p><strong><span>▶ 运行结果</span></strong></p>
    <blockquote>
      <div style="font-family: Arial, sans-serif; line-height: 1.5; margin: 0;">
        <p><span></span><span><strong>&gt;&gt;&gt;&gt;Loop: 1&lt;&lt;&lt;&lt;</strong></span></p>
        <p><span><strong>任务：</strong>帮我订一张2024年11月1日上午从北京去武汉的火车票</span></p>
        <p><span><strong>思考: </strong>根据任务需求，首先需要查询2024年11月1日上午从当前位置到武汉的火车票。这需要使用“查询火车票”工具，指定出发地、目的地、日期以及上午的时间范围。</span></p>
        <p><span><strong>动作/工具:</strong></span></p>
        <p><span>{</span></p>
        <p><span>&quot;name&quot;: &quot;查询火车票&quot;,</span></p>
        <p><span>&quot;args&quot;: {</span></p>
        <p><span>&quot;origin&quot;: &quot;当前位置&quot;,</span></p>
        <p><span>&quot;destination&quot;: &quot;武汉&quot;,</span></p>
        <p><span>&quot;date&quot;: &quot;2024-11-01&quot;,</span></p>
        <p><span>&quot;departure_time_start&quot;: &quot;00:00&quot;,</span></p>
        <p><span>&quot;departure_time_end&quot;: &quot;12:00&quot;</span></p>
        <p><span>}}</span></p>
        <p><span>-----------</span></p>
        <p><span><strong>Observation:</strong></span></p>
        <p><span>[{&#39;train_number&#39;: &#39;G1234&#39;, &#39;origin&#39;: &#39;北京&#39;, &#39;destination&#39;: &#39;武汉&#39;, &#39;departure_time&#39;: &#39;2024-11-01 8:00&#39;, &#39;arrival_time&#39;: &#39;2024-11-01 12:00&#39;, &#39;price&#39;: &#39;100.00&#39;, &#39;seat_type&#39;: &#39;二等座&#39;},</span><br>
        <span>{&#39;train_number&#39;: &#39;G5678&#39;, &#39;origin&#39;: &#39;北京&#39;, &#39;destination&#39;: &#39;武汉&#39;, &#39;departure_time&#39;: &#39;2024-11-01 18:30&#39;, &#39;arrival_time&#39;: &#39;2024-11-01 22:30&#39;, &#39;price&#39;: &#39;100.00&#39;, &#39;seat_type&#39;: &#39;二等座&#39;},</span><br>
        <span>{&#39;train_number&#39;: &#39;G9012&#39;, &#39;origin&#39;: &#39;北京&#39;, &#39;destination&#39;: &#39;武汉&#39;, &#39;departure_time&#39;: &#39;2024-11-01 19:00&#39;, &#39;arrival_time&#39;: &#39;2024-11-01 23:00&#39;, &#39;price&#39;: &#39;100.00&#39;, &#39;seat_type&#39;: &#39;二等座&#39;}]</span></p>
      </div>
    </blockquote>    
    <p>&nbsp;</p>
    <p><span>第一轮：AI Agent 根据要求，选择了需要使用的 Tool，传递了请求参数并完成了调用。此外：还可以多定义一些
        Tools，比如获取当前位置的，获取今天日期的工具等等，这样这里的查询火车票的参数可以更智能。</span></p>
    <p>&nbsp;</p>
    <blockquote>
      <p><span></span><span><strong>&gt;&gt;&gt;&gt;Loop: 2&lt;&lt;&lt;&lt;</strong></span></p>
      <p><span><strong>任务：</strong>帮我订一张2024年11月1日上午从北京去武汉的火车票</span></p>
      <p><span><strong>思考: </strong>根据查询结果，有三个车次可供选择，但只有车次G1234符合上午出发的要求，因此应选择购买这个车次的票。</span></p>
      <p><span><strong>动作/工具:</strong></span></p>
      <p><span>{</span></p>
      <p><span>&quot;name&quot;: &quot;购买火车票&quot;,</span></p>
      <p><span>&quot;args&quot;: {</span></p>
      <p><span>&quot;train_number&quot;: &quot;G1234&quot;</span></p>
      <p><span>}}</span></p>
      <p><span>-</span><span>---</span></p>
      <p><span><strong>Observation:</strong></span></p>
      <p><span>{&#39;result&#39;: &#39;success&#39;, &#39;message&#39;: &#39;购买成功&#39;, &#39;data&#39;:
          {&#39;train_number&#39;: &#39;G1234&#39;, &#39;seat_type&#39;: &#39;二等座&#39;, &#39;seat_number&#39;:
          &#39;7-17A&#39;}}</span></p>
    </blockquote>
    <p>&nbsp;</p>
    <p><span>第二轮：根据查询出的车票信息去调用购票的Tool。</span></p>
    <p>&nbsp;</p>
    <blockquote>
      <div style="font-family: Arial, sans-serif; line-height: 1.5; margin: 0;">
        <p><span></span><span><strong>&gt;&gt;&gt;&gt;Loop: 3&lt;&lt;&lt;&lt;</strong></span></p>
        <p><span><strong>任务：</strong>帮我订一张2024年11月1日上午从北京去武汉的火车票</span></p>
        <p><span><strong>思考: </strong>根据任务需求，首先需要查询2024年11月1日上午从当前位置到武汉的火车票。这需要使用“查询火车票”工具，指定出发地、目的地、日期以及上午的时间范围。</span></p>
        <p><span><strong>动作/工具:</strong></span></p>
        <p><span>{</span></p>
        <p><span>&quot;name&quot;: &quot;查询火车票&quot;,</span></p>
        <p><span>&quot;args&quot;: {</span></p>
        <p><span>&quot;origin&quot;: &quot;当前位置&quot;,</span></p>
        <p><span>&quot;destination&quot;: &quot;武汉&quot;,</span></p>
        <p><span>&quot;date&quot;: &quot;2024-11-01&quot;,</span></p>
        <p><span>&quot;departure_time_start&quot;: &quot;00:00&quot;,</span></p>
        <p><span>&quot;departure_time_end&quot;: &quot;12:00&quot;</span></p>
        <p><span>}}</span></p>
        <p><span>-----------</span></p>
        <p><span><strong>Observation:</strong></span></p>
        <p><span>[{&#39;train_number&#39;: &#39;G1234&#39;, &#39;origin&#39;: &#39;北京&#39;, &#39;destination&#39;: &#39;武汉&#39;, &#39;departure_time&#39;: &#39;2024-11-01 8:00&#39;, &#39;arrival_time&#39;: &#39;2024-11-01 12:00&#39;, &#39;price&#39;: &#39;100.00&#39;, &#39;seat_type&#39;: &#39;二等座&#39;},</span><br>
        <span>{&#39;train_number&#39;: &#39;G5678&#39;, &#39;origin&#39;: &#39;北京&#39;, &#39;destination&#39;: &#39;武汉&#39;, &#39;departure_time&#39;: &#39;2024-11-01 18:30&#39;, &#39;arrival_time&#39;: &#39;2024-11-01 22:30&#39;, &#39;price&#39;: &#39;100.00&#39;, &#39;seat_type&#39;: &#39;二等座&#39;},</span><br>
        <span>{&#39;train_number&#39;: &#39;G9012&#39;, &#39;origin&#39;: &#39;北京&#39;, &#39;destination&#39;: &#39;武汉&#39;, &#39;departure_time&#39;: &#39;2024-11-01 19:00&#39;, &#39;arrival_time&#39;: &#39;2024-11-01 23:00&#39;, &#39;price&#39;: &#39;100.00&#39;, &#39;seat_type&#39;: &#39;二等座&#39;}]</span></p>
      </div>
    </blockquote>
    
    <p>&nbsp;</p>
    <p><span>第三轮：识别到任务已完成，输出了结果。</span></p>
    <p>&nbsp;</p>
    <p><span>至此，我们实现了一个简易的基于ReAct 框架的 </span><code><span>单个</span></code><span> AI Agent 搭建流程。</span></p>
    <p>&nbsp;</p>
    <h2 id='multi-agent-多智能体框架技术'><span>Multi-Agent 多智能体框架技术</span></h2>
    <p>
      <span>人类社会是一个复杂的多智能体系统，每个个体有各自的目标、行为、信念和偏好，同时也需要与他人协作或竞争，以实现共同利益或解决问题。在这一过程中，人类需根据环境变化和任务需求调整策略，理解他人意图，并遵循伦理和法律准则，这正是人类智能的重要表现。</span>
    </p>
    <p>&nbsp;</p>
    <p><span>随着人工智能技术的发展，AI 在游戏、机器人、交通、医疗等领域的应用日益广泛，这些智能体通常不是单独运作的，而是需要与其他多个智能体或人类进行交互，形成一个 Multi-Agent
        多智能体系统（MAS）。例如，在智能交通中，每辆车作为智能体，需要根据路况和交通规则选择速度和路线，并与其他车辆及行人协调，以避免事故和拥堵。在智能医疗中，医生、护士、患者和设备各自作为智能体，共享信息并协商决策，以提高诊疗效率和质量。</span>
    </p>
    <p>&nbsp;</p>
    <p><strong><span>多智能体协作系统（MACS）</span></strong><span>，旨在实现多个智能体的高效协作，完成单个智能体无法完成的任务。MACS
        广泛应用于交通、能源、物流优化，以及智能家居、城市、工厂设计等场景。</span></p>
    <p>&nbsp;</p>
    <p><strong><span>多智能体框架经典案例</span></strong></p>
    <div class="image-container">
      <img src="https://jacksonzjh.github.io/ai-tech/Ai-TechArticles/AiAgent/images/p6.png" alt="Image Description">
    </div>
    <p style="color: #b3b3b3; text-align: center; margin-top: 8px;">
      <span><u>斯坦福大学研究者发布的"虚拟小镇"项目，实现了多个AI智能体协作的经典案例</u></span>
    </p>
    <p>&nbsp;</p>
    <p><span>如果你看过《西部世界》，一定对那个高科技未来虚拟世界印象深刻：在这个乐园里，拟真人的机器人可以像人类一样行事，记得自己看到的、说过的话……每天他们被重置，重新投入核心剧情。</span></p>
    <p>&nbsp;</p>
    <p><span>这类场景曾经只存在于影视剧中，但随着斯坦福大学发布的论文《Generative Agents: Interactive Simulacra of Human Behavior》，AI 已经实现了类似的复现。</span>
    </p>
    <p>&nbsp;</p>
    <ul>
      <li><span>论文地址：</span><a href='https://arxiv.org/pdf/2304.03442v1.pdf' target='_blank'
          class='url'>https://arxiv.org/pdf/2304.03442v1.pdf</a></li>
      <li><span>项目地址：</span><a href='https://github.com/joonspk-research/generative_agents' target='_blank'
          class='url'>https://github.com/joonspk-research/generative_agents</a></li>
    </ul>
    <p>&nbsp;</p>
    <p><span>研究者们创建了一个名为Smallville的虚拟小镇，镇上生活着25个 AI 智能体，他们有各自的工作、兴趣，会八卦、社交，甚至举办情人节派对。每个 “居民”
        都有独特的个性和背景故事，增添了真实感。小镇中还设置了咖啡馆、酒吧、公园、学校等公共场景，居民们可以随意走动、进入不同场所，甚至主动打招呼。</span></p>
    <p>&nbsp;</p>
    <p><span>随着项目的开源，将会影响到更多领域，特别是游戏行业。</span></p>
    <p>&nbsp;</p>
    <h2 id='未来挑战和前景'><span>未来挑战和前景</span></h2>
    <p><span>在多智能体场景中，智能体以不同的方式协作，类似于分布式计算模式：顺序、集中、分散或共享消息池。</span></p>
    <p>&nbsp;</p>
    <ul>
      <li><strong><span>工作流管理：多智能体系统的一个用例</span></strong></li>
    </ul>
    <p>
      <span>大多数工业流程都涉及工作流管理，无论是贷款处理、营销活动管理还是软件开发。实现特定目标需要顺序或循环的步骤。在传统方法中，每个步骤（例如贷款申请验证）都需要人工来执行繁琐且单调的任务，即手动处理每个申请并进行验证，然后再进入下一步。</span>
    </p>
    <p>&nbsp;</p>
    <p><span>每个步骤都需要该领域专家的输入。，每个步骤都由一个由多个智能体组成的团队来处理。例如，在贷款申请验证中，一个智能体可能通过背景检查（如身份证等文件）来验证用户的身份，而另一个智能体则验证用户的财务信息。</span>
    </p>
    <p>&nbsp;</p>
    <p><span>这就引出了一个问题：一个团队（包含多个顺序或层级结构的智能体）能否处理所有贷款处理步骤? 虽然理论上可行，但这会使团队变得复杂，需要大量的临时记忆，并增加目标偏离和幻觉的风险。</span></p>
    <p>&nbsp;</p>
    <p><span>由于 LLM 仍处于智能发展的早期阶段，因此无法完全自主地管理整个工作流。在关键阶段需要人工参与进行最终用户验证。例如，在团队完成贷款申请验证步骤后，需要人工监督来验证结果。随着时间的推移，随着对 AI
        的信任增加，某些步骤可能会变得完全自主。目前，基于 AI 的工作流管理起着辅助作用，简化了繁琐的任务并减少了整体处理时间。</span></p>
    <p>&nbsp;</p>
    <ul>
      <li><strong><span>生产挑战</span></strong></li>
    </ul>
    <p><span>将多智能体解决方案投入生产可能会面临几个挑战：</span></p>
    <p><span>• 规模：随着智能体数量的增加，协作和管理变得具有挑战性。</span></p>
    <p><span>• 延迟：由于任务迭代执行，需要多次调用LLM，因此智能体性能往往会产生延迟。受管理的LLM 由于隐式护栏和网络延迟而速度较慢。</span></p>
    <p><span>• 性能和幻觉问题：由于LLM的概率性质，智能体的性能可能会因每次执行而异。像输出模板化（例如JSON格式）和在提示中提供充足示例等技术有助于减少响应的可变性。</span></p>
    <p>&nbsp;</p>
    <p><strong><span>最后的思考</span></strong></p>
    <p><span>正如吴恩达教授（Andrew Ng）所指出的，智能体是 AI 的未来，并将与 LLM 一起不断发展。多智能体系统将在处理多模态数据(文本、图像、视频、音频)和应对日益复杂的任务方面取得进展。</span></p>
    <p>&nbsp;</p>
    <div class="image-container">
      <img src="https://jacksonzjh.github.io/ai-tech/Ai-TechArticles/AiAgent/images/p7.png" alt="Image Description">
    </div>
    <p style="color: #b3b3b3; text-align: center; margin-top: 8px;">
      <span><u>国内很成功的 AI 智能体生态化产品 —— 字节豆包 AI 助手</u></span>
    </p>
    </div>
</div>
</body>
</html>